"use strict";var WebpayPlus=require("transbank-sdk").WebpayPlus,asyncHandler=require("../utils/async_handler");exports.create=asyncHandler(function(a,n){var r,t,s,o,i,c,u,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r="O-"+Math.floor(1e4*Math.random())+1,t="S-"+Math.floor(1e4*Math.random())+1,s=1e3,o=a.protocol+"://"+a.get("host")+"/webpay_plus/commit",e.next=6,regeneratorRuntime.awrap(WebpayPlus.Transaction.create(r,t,s,o));case 6:i=e.sent,c=i.token,u=i.url,d={buyOrder:r,sessionId:t,amount:s,returnUrl:o,token:c,url:u},n.render("webpay_plus/create",{step:"Crear Transacción",stepDescription:"En este paso crearemos la transacción con el objetivo de obtener un identificador unico y poder en el siguiente paso redirigir al Tarjetahabiente hacia el formulario de pago",viewData:d});case 11:case"end":return e.stop()}})}),exports.commit=asyncHandler(function(a,n){var r,t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.body.token_ws,e.next=3,regeneratorRuntime.awrap(WebpayPlus.Transaction.commit(r));case 3:t=e.sent,s={token:r,commitResponse:t},n.render("webpay_plus/commit",{step:"Confirmar Transacción",stepDescription:"En este paso tenemos que confirmar la transacción con el objetivo de avisar a Transbank que hemos recibido la transacción ha sido recibida exitosamente. En caso de que no se confirme la transacción, ésta será reversada.",viewData:s});case 6:case"end":return e.stop()}})}),exports.status=asyncHandler(function(a,n){var r,t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.body.token,e.next=3,regeneratorRuntime.awrap(WebpayPlus.Transaction.status(r));case 3:t=e.sent,s={token:r,statusResponse:t},n.render("webpay_plus/status",{step:"Estado de Transacción",stepDescription:"Puedes solicitar el estado de una transacción hasta 7 días despues de que haya sido realizada. No hay limite de solicitudes de este tipo, sin embargo, una vez pasados los 7 días ya no podrás revisar su estado.",viewData:s});case 6:case"end":return e.stop()}})}),exports.refund=asyncHandler(function(a,n){var r,t,s,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.body,t=r.token,s=r.amount,e.next=3,regeneratorRuntime.awrap(WebpayPlus.Transaction.refund(t,s));case 3:o=e.sent,i={token:t,amount:s,refundResponse:o},n.render("webpay_plus/refund",{step:"Reembolso de Transacción",stepDescription:"Podrás pedir el reembolso del dinero al tarjeta habiente, dependiendo del monto y el tiempo transacurrido será una Reversa, Anulación o Anulación parcial.",viewData:i});case 6:case"end":return e.stop()}})});
//# sourceMappingURL=webpay_plus.min.js.map
